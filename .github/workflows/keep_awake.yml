name: keep-streamlit-awake

on:
  workflow_dispatch:
  schedule:
    - cron: "*/15 * * * *"

jobs:
  wake:
    runs-on: ubuntu-latest
    steps:
      - name: Wake Streamlit via Playwright
        run: |
          npm init -y >/dev/null 2>&1
          npm i -D playwright >/dev/null 2>&1
          npx playwright install --with-deps chromium >/dev/null 2>&1

          node <<'NODE'
          const { chromium } = require('playwright');

          (async () => {
            const url = "https://dividend-analysis-project-singaseong96.streamlit.app/";
            const browser = await chromium.launch();
            const page = await browser.newPage();
            const resp = await page.goto(url, { waitUntil: 'domcontentloaded', timeout: 60000 });
            console.log("STATUS=", resp ? resp.status() : "NO_RESPONSE");
            // Streamlit이 완전히 뜰 시간 조금 줌
            await page.waitForTimeout(15000);
            await browser.close();
          })().catch(e => { console.error(e); process.exit(1); });
          NODE
